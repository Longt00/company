<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>颜色对比度测试</title>
    <link rel="stylesheet" href="../styles/variables.css">
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            transition: background-color 0.3s ease;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .color-picker-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .color-picker-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .color-input-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid var(--color-text-auto-disabled);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-input:hover {
            border-color: var(--color-text-auto-accent);
            transform: scale(1.05);
        }

        .color-value {
            font-family: monospace;
            font-size: 14px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            border: 1px solid var(--color-text-auto-disabled);
        }

        .text-samples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .text-sample {
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-text-auto-disabled);
        }

        .contrast-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .contrast-item {
            padding: 10px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .contrast-value {
            font-size: 18px;
            font-weight: bold;
        }

        .wcag-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }

        .wcag-pass {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid #4caf50;
        }

        .wcag-warning {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
            border: 1px solid #ff9800;
        }

        .wcag-fail {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 10px 20px;
            border: 1px solid var(--color-text-auto-secondary);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-text-auto-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--color-text-auto-primary);
            transform: translateY(-2px);
        }

        .gradient-preview {
            height: 60px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid var(--color-text-auto-disabled);
            transition: all 0.3s ease;
        }

        .gradient-preview:hover {
            border-color: var(--color-text-auto-accent);
            transform: scale(1.02);
        }

        .test-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--color-text-auto-disabled);
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--color-text-auto-accent);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        @media (max-width: 768px) {
            .test-container {
                padding: 10px;
            }

            .test-section {
                padding: 15px;
            }

            .color-picker-group {
                grid-template-columns: 1fr;
            }

            .text-samples {
                grid-template-columns: 1fr;
            }

            .contrast-info {
                grid-template-columns: 1fr;
            }

            .preset-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="text-auto-primary">颜色对比度和可读性测试</h1>
            <p class="text-auto-secondary">测试不同背景色下的字体颜色自动调整和 WCAG 合规性</p>
        </div>

        <!-- 背景颜色选择器 -->
        <div class="test-section">
            <h2 class="text-auto-primary mb-3">背景颜色设置</h2>

            <div class="test-controls">
                <div class="control-group">
                    <span class="text-auto-secondary">背景类型：</span>
                    <select id="backgroundType" class="form-control" style="width: auto;">
                        <option value="solid">纯色背景</option>
                        <option value="gradient">渐变背景</option>
                    </select>
                </div>

                <div class="control-group">
                    <span class="text-auto-secondary">自动计算字体颜色：</span>
                    <div id="autoColorToggle" class="toggle-switch active">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- 纯色背景选择器 -->
            <div id="solidColorPicker" class="color-picker-group">
                <div class="color-picker-item">
                    <label class="text-auto-secondary">背景颜色</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="backgroundColor" class="color-input" value="#ffffff">
                        <span class="color-value">#ffffff</span>
                    </div>
                </div>
            </div>

            <!-- 渐变背景选择器 -->
            <div id="gradientColorPicker" class="color-picker-group" style="display: none;">
                <div class="color-picker-item">
                    <label class="text-auto-secondary">渐变开始颜色</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="gradientStart" class="color-input" value="#667eea">
                        <span class="color-value">#667eea</span>
                    </div>
                </div>
                <div class="color-picker-item">
                    <label class="text-auto-secondary">渐变结束颜色</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="gradientEnd" class="color-input" value="#764ba2">
                        <span class="color-value">#764ba2</span>
                    </div>
                </div>
                <div class="color-picker-item">
                    <label class="text-auto-secondary">渐变方向</label>
                    <select id="gradientDirection" class="form-control">
                        <option value="45deg">对角线 (45°)</option>
                        <option value="90deg">水平 (90°)</option>
                        <option value="180deg">垂直 (180°)</option>
                        <option value="135deg">反对角线 (135°)</option>
                    </select>
                </div>
            </div>

            <!-- 渐变预览 -->
            <div id="gradientPreview" class="gradient-preview" style="display: none;"></div>

            <!-- 预设主题 -->
            <div class="preset-buttons">
                <button class="preset-btn" onclick="applyPreset('#ffffff')">纯白</button>
                <button class="preset-btn" onclick="applyPreset('#000000')">纯黑</button>
                <button class="preset-btn" onclick="applyPreset('#f5f5f5')">浅灰</button>
                <button class="preset-btn" onclick="applyPreset('#2c3e50')">深蓝灰</button>
                <button class="preset-btn" onclick="applyGradient('#667eea', '#764ba2')">海洋</button>
                <button class="preset-btn" onclick="applyGradient('#ff6a00', '#ff9500')">日落</button>
                <button class="preset-btn" onclick="applyGradient('#28a745', '#20c997')">森林</button>
                <button class="preset-btn" onclick="applyGradient('#f12711', '#f5af19')">火焰</button>
            </div>
        </div>

        <!-- 文本样本测试 -->
        <div class="test-section">
            <h2 class="text-auto-primary mb-3">文本可读性测试</h2>

            <!-- 自定义字体颜色选择器 -->
            <div id="customTextColorPicker" class="color-picker-group mb-4" style="display: none;">
                <div class="color-picker-item">
                    <label class="text-auto-secondary">主要文本颜色</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="primaryTextColor" class="color-input" value="#000000">
                        <span class="color-value">#000000</span>
                    </div>
                </div>
                <div class="color-picker-item">
                    <label class="text-auto-secondary">次要文本颜色</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="secondaryTextColor" class="color-input" value="#666666">
                        <span class="color-value">#666666</span>
                    </div>
                </div>
                <div class="color-picker-item">
                    <label class="text-auto-secondary">链接颜色</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="linkColor" class="color-input" value="#1976d2">
                        <span class="color-value">#1976d2</span>
                    </div>
                </div>
            </div>

            <div class="text-samples">
                <div class="text-sample">
                    <h3 class="text-auto-primary">主要文本</h3>
                    <p class="text-auto-primary">这是主要文本内容，应该具有最佳的对比度和可读性。 Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                </div>
                <div class="text-sample">
                    <h3 class="text-auto-secondary">次要文本</h3>
                    <p class="text-auto-secondary">这是次要文本内容，对比度较低但仍应保持可读性。 Sed do eiusmod tempor incididunt ut labore.</p>
                </div>
                <div class="text-sample">
                    <h3 class="text-auto-link">链接文本</h3>
                    <p><a href="#" class="text-auto-link">这是一个链接示例</a>，应该具有足够的对比度和识别性。 Ut enim ad minim veniam.</p>
                </div>
                <div class="text-sample">
                    <h3 class="text-auto-accent">强调文本</h3>
                    <p class="text-auto-accent">这是强调色文本，用于突出重要信息。 Quis nostrud exercitation ullamco laboris.</p>
                </div>
                <div class="text-sample">
                    <h3>大号文本测试</h3>
                    <p class="text-auto-primary" style="font-size: 24px;">大号文本 <strong style="font-size: 32px;">更大文本</strong> 超大文本</p>
                </div>
                <div class="text-sample">
                    <h3>小号文本测试</h3>
                    <p class="text-auto-secondary" style="font-size: 12px;">小号文本内容 <span style="font-size: 10px;">更小文本</span> 最小文本</p>
                </div>
            </div>
        </div>

        <!-- 对比度信息 -->
        <div class="test-section">
            <h2 class="text-auto-primary mb-3">WCAG 对比度合规性检查</h2>

            <div class="contrast-info">
                <div class="contrast-item">
                    <span class="text-auto-secondary">主要文本对比度</span>
                    <span class="contrast-value text-auto-primary" id="primaryContrast">21:1</span>
                    <div id="primaryAA" class="wcag-status wcag-pass">AA ✅</div>
                    <div id="primaryAAA" class="wcag-status wcag-pass">AAA ✅</div>
                </div>
                <div class="contrast-item">
                    <span class="text-auto-secondary">次要文本对比度</span>
                    <span class="contrast-value text-auto-primary" id="secondaryContrast">7:1</span>
                    <div id="secondaryAA" class="wcag-status wcag-pass">AA ✅</div>
                    <div id="secondaryAAA" class="wcag-status wcag-pass">AAA ✅</div>
                </div>
                <div class="contrast-item">
                    <span class="text-auto-secondary">链接对比度</span>
                    <span class="contrast-value text-auto-primary" id="linkContrast">4.5:1</span>
                    <div id="linkAA" class="wcag-status wcag-pass">AA ✅</div>
                    <div id="linkAAA" class="wcag-status wcag-warning">AAA ⚠️</div>
                </div>
                <div class="contrast-item">
                    <span class="text-auto-secondary">强调色对比度</span>
                    <span class="contrast-value text-auto-primary" id="accentContrast">3:1</span>
                    <div id="accentAA" class="wcag-status wcag-warning">AA ⚠️</div>
                    <div id="accentAAA" class="wcag-status wcag-fail">AAA ❌</div>
                </div>
            </div>
        </div>

        <!-- 组件测试 -->
        <div class="test-section">
            <h2 class="text-auto-primary mb-3">UI 组件测试</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- 按钮测试 -->
                <div class="component-group">
                    <h3 class="text-auto-secondary mb-2">按钮组件</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <button class="btn-auto">默认按钮</button>
                        <button class="btn-auto-primary">主要按钮</button>
                        <button class="btn-auto" disabled>禁用按钮</button>
                    </div>
                </div>

                <!-- 表单测试 -->
                <div class="component-group">
                    <h3 class="text-auto-secondary mb-2">表单组件</h3>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <input type="text" class="form-control" placeholder="输入框示例">
                        <select class="form-control">
                            <option>选择框示例</option>
                            <option>选项1</option>
                            <option>选项2</option>
                        </select>
                    </div>
                </div>

                <!-- 表格测试 -->
                <div class="component-group">
                    <h3 class="text-auto-secondary mb-2">表格组件</h3>
                    <table class="table-auto" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th style="padding: 8px; border: 1px solid currentColor;">姓名</th>
                                <th style="padding: 8px; border: 1px solid currentColor;">年龄</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 8px; border: 1px solid currentColor;">张三</td>
                                <td style="padding: 8px; border: 1px solid currentColor;">25</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid currentColor;">李四</td>
                                <td style="padding: 8px; border: 1px solid currentColor;">30</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 代码块测试 -->
                <div class="component-group">
                    <h3 class="text-auto-secondary mb-2">代码块</h3>
                    <pre class="code-auto" style="padding: 10px; border-radius: 6px; overflow-x: auto;"><code>function calculateContrast(color1, color2) {
    const lum1 = getLuminance(color1);
    const lum2 = getLuminance(color2);
    return (Math.max(lum1, lum2) + 0.05) /
           (Math.min(lum1, lum2) + 0.05);
}</code></pre>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { ColorContrastHelper } from '../utils/colorContrastHelper.js';
        import { themeManager } from '../utils/themeManager.js';

        // 全局变量
        let autoColorEnabled = true;
        let backgroundType = 'solid';

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            updateColors();
        });

        // 初始化事件监听器
        function initializeEventListeners() {
            // 背景类型切换
            document.getElementById('backgroundType').addEventListener('change', (e) => {
                backgroundType = e.target.value;
                toggleColorPickers();
                updateColors();
            });

            // 自动计算开关
            document.getElementById('autoColorToggle').addEventListener('click', () => {
                autoColorEnabled = !autoColorEnabled;
                document.getElementById('autoColorToggle').classList.toggle('active');
                document.getElementById('customTextColorPicker').style.display =
                    autoColorEnabled ? 'none' : 'block';
                updateColors();
            });

            // 颜色输入监听器
            const colorInputs = [
                { id: 'backgroundColor', type: 'solid' },
                { id: 'gradientStart', type: 'gradient' },
                { id: 'gradientEnd', type: 'gradient' },
                { id: 'gradientDirection', type: 'gradient' }
            ];

            colorInputs.forEach(input => {
                const element = document.getElementById(input.id);
                if (element) {
                    element.addEventListener('input', () => {
                        updateColorValue(input.id);
                        updateColors();
                    });
                }
            });

            // 自定义字体颜色输入监听器
            const textColorInputs = ['primaryTextColor', 'secondaryTextColor', 'linkColor'];
            textColorInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => {
                        updateColorValue(id);
                        if (!autoColorEnabled) {
                            updateColors();
                        }
                    });
                }
            });
        }

        // 切换颜色选择器显示
        function toggleColorPickers() {
            const solidPicker = document.getElementById('solidColorPicker');
            const gradientPicker = document.getElementById('gradientColorPicker');
            const gradientPreview = document.getElementById('gradientPreview');

            if (backgroundType === 'solid') {
                solidPicker.style.display = 'grid';
                gradientPicker.style.display = 'none';
                gradientPreview.style.display = 'none';
            } else {
                solidPicker.style.display = 'none';
                gradientPicker.style.display = 'grid';
                gradientPreview.style.display = 'block';
            }
        }

        // 更新颜色值显示
        function updateColorValue(inputId) {
            const input = document.getElementById(inputId);
            const valueSpan = input.nextElementSibling;
            if (valueSpan && valueSpan.classList.contains('color-value')) {
                valueSpan.textContent = input.value;
            }
        }

        // 更新所有颜色
        function updateColors() {
            let backgroundColor;

            if (backgroundType === 'solid') {
                backgroundColor = document.getElementById('backgroundColor').value;
                themeManager.setSolidBackground(backgroundColor);
            } else {
                const startColor = document.getElementById('gradientStart').value;
                const endColor = document.getElementById('gradientEnd').value;
                const direction = document.getElementById('gradientDirection').value;
                themeManager.setGradientBackground(startColor, endColor, direction);

                // 更新渐变预览
                const preview = document.getElementById('gradientPreview');
                preview.style.background = `linear-gradient(${direction}, ${startColor}, ${endColor})`;

                backgroundColor = ColorContrastHelper.calculateGradientMidColor(startColor, endColor);
            }

            // 应用自定义字体颜色或自动计算
            if (!autoColorEnabled) {
                const primaryColor = document.getElementById('primaryTextColor').value;
                const secondaryColor = document.getElementById('secondaryTextColor').value;
                const linkColor = document.getElementById('linkColor').value;

                themeManager.setCustomTextColors({
                    primary: primaryColor,
                    secondary: secondaryColor,
                    link: linkColor
                });
            }

            // 更新对比度信息
            updateContrastInfo(backgroundColor);
        }

        // 更新对比度信息
        function updateContrastInfo(backgroundColor) {
            const theme = themeManager.getCurrentTheme();
            const colors = theme.textColors;

            const contrastData = [
                { id: 'primary', color: colors.primary, backgroundColor },
                { id: 'secondary', color: colors.secondary, backgroundColor },
                { id: 'link', color: colors.link, backgroundColor },
                { id: 'accent', color: colors.accent, backgroundColor }
            ];

            contrastData.forEach(data => {
                const contrast = ColorContrastHelper.getContrast(data.color, data.backgroundColor);
                const contrastValue = Math.round(contrast * 100) / 100;

                // 更新对比度值
                const contrastElement = document.getElementById(`${data.id}Contrast`);
                if (contrastElement) {
                    contrastElement.textContent = `${contrastValue}:1`;
                }

                // 更新 WCAG 状态
                updateWCAGStatus(data.id, contrast);
            });
        }

        // 更新 WCAG 状态
        function updateWCAGStatus(id, contrast) {
            const aaElement = document.getElementById(`${id}AA`);
            const aaaElement = document.getElementById(`${id}AAA`);

            if (aaElement && aaaElement) {
                const aaPass = contrast >= 4.5;
                const aaaPass = contrast >= 7.0;

                updateStatusElement(aaElement, aaPass);
                updateStatusElement(aaaElement, aaaPass);
            }
        }

        // 更新状态元素
        function updateStatusElement(element, isPass) {
            element.classList.remove('wcag-pass', 'wcag-warning', 'wcag-fail');

            if (isPass) {
                element.classList.add('wcag-pass');
                element.textContent = element.id.includes('AAA') ? 'AAA ✅' : 'AA ✅';
            } else {
                element.classList.add('wcag-fail');
                element.textContent = element.id.includes('AAA') ? 'AAA ❌' : 'AA ❌';
            }
        }

        // 应用预设纯色
        function applyPreset(color) {
            document.getElementById('backgroundType').value = 'solid';
            backgroundType = 'solid';
            document.getElementById('backgroundColor').value = color;
            updateColorValue('backgroundColor');
            toggleColorPickers();
            updateColors();
        }

        // 应用预设渐变
        function applyGradient(startColor, endColor) {
            document.getElementById('backgroundType').value = 'gradient';
            backgroundType = 'gradient';
            document.getElementById('gradientStart').value = startColor;
            document.getElementById('gradientEnd').value = endColor;
            updateColorValue('gradientStart');
            updateColorValue('gradientEnd');
            toggleColorPickers();
            updateColors();
        }

        // 全局函数
        window.applyPreset = applyPreset;
        window.applyGradient = applyGradient;
    </script>
</body>
</html>